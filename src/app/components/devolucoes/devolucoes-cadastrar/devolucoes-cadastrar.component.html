<nb-card>
  <nb-card-body>

    <nb-stepper #stepper [linear]="linearMode">
      <!-- Primeira Etapa do Formulario ABAIXO:-->
      <nb-step [stepControl]="nameForm">
        <form #nameForm="ngForm" class="step-container" #stepperForm="ngForm">
          <div class="row">

            <!-- Filial - Serie - CTE -->
            <div class="col-sm-6">
              <div class="labelcte">
                <label for="filial" class="label">Filial</label>

                <label for="serie" class="label">Serie</label>

                <label for="cte" class="label">CTE</label>

              </div>

              <div class="form-group-cte">
                <input type="number" nbInput placeholder="" id="filial" name="filial"
                  [(ngModel)]="notaFiscal.dados.filial" required>
                <input type="number" nbInput placeholder="" id="serie" name="serie" [(ngModel)]="notaFiscal.dados.serie"
                  required>
                <input type="number" nbInput placeholder="" id="cte" name="cte" [(ngModel)]="notaFiscal.dados.cte"
                  required>
              </div>
            </div>

            <!-- Numero NFd -->
            <div class="col-sm-6">
              <div class="form-group">
                <label for="numeroNfd" class="label">Número da NF de Devolução</label>
              </div>

              <div class="form-group">
                <input type="number" nbInput fullWidth id="numeroNfd" placeholder=""
                  [(ngModel)]="notaFiscal.dados.numeroNfd" name="numeroNfd" required class="input-nfd">
              </div>

            </div>


            <!-- Numero NFO -->
            <div class="col-sm-6">
              <div class="form-group">
                <label for="numeroNfo" class="label">Número da NF de Origem</label>
              </div>

              <div class="form-group">
                <input type="number" nbInput fullWidth id="numeroNfo" placeholder="" name="numeroNfo"
                  [(ngModel)]="notaFiscal.dados.numeroNfo" required class="input-nfd">
              </div>

            </div>

            <!-- Opções de Armazem -->

            <div class="col-sm-6">


              <!-- Opções de Motivo-->

              <div class="col-sm-6">
                <div class="form-group">
                  <label class="label">Motivo</label>
                </div>
              </div>

              <nb-select fullWidth placeholder="Selecione o motivo" class="nb-select-motivo" name="motivo" id="motivo"
                [(ngModel)]="notaFiscal.dados.motivo" required>
                <nb-option>Nenhuma das alternativas</nb-option>
                <nb-option value="1">Avaria</nb-option>
                <nb-option value="2">Falta</nb-option>
                <nb-option value="3">Devolucao</nb-option>
              </nb-select>

              <!-- Observação -->

              <div class="col-sm-6">
                <div class="form-group">
                  <label for="observacao" class="label">Observações</label>
                </div>
              </div>
              <textarea rows="5" nbInput fullWidth shape="round" id="observacao" placeholder="" name="observacao"
                required nbInput [(ngModel)]="notaFiscal.dados.observacao" #observacaoInput="ngModel"
                class="custom-textarea"></textarea>



            </div>
          </div>
          <!--    -->

          <button nbButton outline shape="semi-round" nbStepperNext (click)="verdados()" [disabled]="!nameForm.valid"
            status="primary">Continuar</button>
        </form>
      </nb-step>

      <!-- Segunda Etapa do Formulario -->
      <nb-step [stepControl]="somethingForm">
        <!-- Definindo os campos no formulario da Segunda etapa-->
        <form #somethingForm="ngForm">
          <div>
            <button nbButton outline shape="semi-round" status="info" class="button-adicionar-prod"
              (click)="openDialog()">Adicionar
              Produto</button>

            <table mat-table [dataSource]="dataSource">


              <!-- Nome do Produto -->
              <ng-container matColumnDef="nome">
                <th mat-header-cell *matHeaderCellDef> Nome Produto </th>
                <td mat-cell *matCellDef="let element"> {{element.nome}} </td>
              </ng-container>

              <!-- Adicione uma nova coluna para o ícone de exclusão -->
              <ng-container matColumnDef="acao">
                <th mat-header-cell *matHeaderCellDef> Ação </th>
                <td mat-cell *matCellDef="let element">

                  <button nbButton status="danger" (click)="excluirProduto(element)" class="button-excluir-prod">
                    <i class="material-icons delete">delete</i>
                  </button>
                </td>
              </ng-container>


              <!-- Quantidade do Produto -->
              <ng-container matColumnDef="quantidade">
                <th mat-header-cell *matHeaderCellDef> Quantidade </th>
                <td mat-cell *matCellDef="let element"> {{element.quantidade}} </td>
              </ng-container>

              <!-- Valor do Produto -->
              <ng-container matColumnDef="valor">
                <th mat-header-cell *matHeaderCellDef> Valor Unitário </th>
                <td mat-cell *matCellDef="let element"> {{element.valor}} </td>
              </ng-container>

              <!--Situacao do Produto -->
              <ng-container matColumnDef="situacao">
                <th mat-header-cell *matHeaderCellDef> Situação </th>
                <td mat-cell *matCellDef="let element"> {{element.situacao}} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

              <!-- Row shown when there is no matching data. -->
              <tr class="mat-row" *matNoDataRow>

              </tr>
            </table>

            <!-- botao de continuar-->
            <button nbButton nbStepperNext status="success" (click)="verdados()"
              class="button-concluir">Continuar</button>
          </div>
        </form>
      </nb-step>

      <!-- Terceira etapa do formulario-->
      <nb-step [stepControl]="movieForm">
        <!-- Definindo os campos no formulario da segunda etapa-->
        <form #movieForm="ngForm" class="step-container2">
          <div class="row">

            <!-- CLIENTES/PESSOA/MOTORISTA -->
            <div class="col-sm-6">
              <div class="labelcliente">
                <label for="cliente.cnpj" class="label" style="margin-right: 290px;">CNPJ</label>
                <label for="cliente.nome" class="label">Nome do Cliente</label>
              </div>

              <div class="form-group-cliente">
                <input type="number" nbInput placeholder="" id="cliente.cnpj" name="cliente.cnpj"
                  [(ngModel)]="notaFiscal.valores.cliente.cnpj" required>
                <input type="text" nbInput placeholder="" id="cliente.nome" name="cliente.nome"
                  [(ngModel)]="notaFiscal.valores.cliente.nome" required>


              </div>
            </div>


            <!-- Motorista-->
            <div class="col-sm-6">
              <div class="form-group">
                <label class="label">Motorista</label>
              </div>
            </div>

            <div class="form-group3">
              <nb-select fullWidth placeholder="Selecione um Motorista" class="nb-select-motorista" id="motorista.nome"
                name="motorista.id" [(ngModel)]="notaFiscal.valores.motorista.id" required>
                <nb-option>Nenhuma das alternativas</nb-option>
                <nb-option value="1">Jose</nb-option>
                <nb-option value="2">Jaun</nb-option>
                <nb-option value="3">Option 3</nb-option>
              </nb-select>

              <div class="form-group-toggle">
                <div style="display: flex;">
                  <label class="label" style="margin-bottom: 5px;">Motorista alertou Avaria?</label>
                  <label class="label" style="margin-bottom: 5px;" *ngIf="debitarValorMotorista">Debitar Valor do
                    Motorista?</label>
                </div>

                <nb-toggle labelPosition="right" status="primary" [(checked)]="debitarValorMotorista"
                  style="margin-bottom: 0.7rem !important;">
                  <span nbSpan *ngIf="!debitarValorMotorista" class="visual-text"
                    [(ngModel)]="notaFiscal.valores.motorista.valorDebitado">Debitar do Motorista:
                    R${{calcularSomaProdutos()}}</span>

                  <input type="number" nbInput *ngIf="debitarValorMotorista" placeholder="Digite o valor"
                    id="motorista-debitado" name="motorista-debitado"
                    [(ngModel)]="notaFiscal.valores.motorista.valorDebitado" required
                    style="margin-left:265px; width: 70%">
                </nb-toggle>

              </div>



            </div>

            <!-- Armazem-->
            <div class="col-sm-6">
              <div class="form-group">
                <label class="label">Comprador</label>
              </div>
            </div>

            <div class="form-group">
              <nb-select fullWidth placeholder="Selecione um Comprador" id="comprador" class="nb-select-motorista"
                name="comprador.id" [(ngModel)]="notaFiscal.valores.comprador.id" required>
                <nb-option>Nenhuma das alternativas</nb-option>
                <nb-option value="1">Jose</nb-option>
                <nb-option value="2">Jaun</nb-option>
                <nb-option value="3">Option 3</nb-option>
              </nb-select>

            </div>


            <!-- Comprador-->
            <div class="col-sm-6">
              <div class="form-group">
                <label class="label">Armazem</label>
              </div>
            </div>

            <div class="form-group">
              <nb-select fullWidth placeholder="Selecione um Armazem" id="armazem" class="nb-select-motorista"
                name="armazem.id" [(ngModel)]="notaFiscal.valores.armazem.id" required>
                <nb-option>Nenhuma das alternativas</nb-option>
                <nb-option value="1">Jose</nb-option>
                <nb-option value="2">Jaun</nb-option>
                <nb-option value="3">Option 3</nb-option>
              </nb-select>

            </div>

            <!-- botao de continuar-->
            <button nbButton nbStepperNext (click)="verdados()" [disabled]="!movieForm.valid" status="primary"
              class="button-step2">Continuar</button>

          </div>
        </form>

      </nb-step>

      <!-- Ultima etapa do formulario e a solicitação de cadastro novamente-->
      <nb-step [hidden]="true">
        <div class="step-container">
          <h3>Cadastro completo!</h3>
          <button nbButton status="success" (click)="stepper.reset()">Cadastrar novamente?</button>
        </div>
      </nb-step>
    </nb-stepper>
  </nb-card-body>
</nb-card>
